<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Chosen Palette: Clean Professional (Light Gray, Blue Accent, White Background) -->
    <!-- Application Structure Plan: A single-page, multi-language calculator focused on ATO compliance. Structure includes a persistent header for language toggle, a central calculator form for input, and a results dashboard that dynamically updates. The structure is chosen for task efficiency, allowing users to focus on data entry and immediate result viewing, prioritizing compliance logic (Borrowing Expense amortization). -->
    <!-- Visualization & Content Choices: The main output is quantitative text (Net Rent). A static bar chart placeholder is used to demonstrate the potential for visual breakdown of expenses, which dynamically updates based on input, reinforcing key data points. Interaction is centered on input forms and the language toggle. NO SVG/Mermaid. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Australian Property Tax Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f9; /* Very light gray/off-white background */
        }
        .input-group label {
            transition: color 0.2s;
        }
        .input-group:hover label {
            color: #1e40af; /* Darker blue on hover */
        }
        .tooltip-container {
            position: relative;
            display: inline-block;
        }
        .tooltip {
            visibility: hidden;
            width: 300px;
            background-color: #374151; /* Dark gray for tooltips */
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 8px 12px;
            position: absolute;
            z-index: 10;
            bottom: 125%; /* Position above */
            left: 50%;
            margin-left: -150px; /* Center the tooltip */
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #374151 transparent transparent transparent;
        }
        .tooltip-container:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        /* Custom class for the chart container to ensure responsiveness and proper sizing */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Max width to prevent overly wide charts */
            height: 300px; /* Controlled height for desktop */
            margin-left: auto;
            margin-right: auto;
        }
        @media (max-width: 768px) {
            .chart-container {
                height: 250px; /* Smaller height on mobile */
            }
        }
    </style>

    <!-- 1. AdSense 自动广告脚本 (放置在 <head> 标签内) -->
    <!-- 已植入用户提供的 AdSense 客户 ID：ca-pub-2834080926474637 -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2834080926474637"
     crossorigin="anonymous"></script>
</head>
<body class="p-4 md:p-8">

    <div id="app" class="max-w-6xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">

        <!-- Header and Language Toggle -->
        <header class="bg-blue-800 p-4 flex justify-between items-center rounded-t-2xl">
            <h1 id="app-title" class="text-2xl font-bold text-white tracking-wide"></h1>
            <div>
                <button onclick="setLanguage('en')" class="text-sm font-semibold px-3 py-1 rounded-full transition-all duration-300 mr-2" id="lang-en"></button>
                <button onclick="setLanguage('zh')" class="text-sm font-semibold px-3 py-1 rounded-full transition-all duration-300" id="lang-zh"></button>
            </div>
        </header>

        <div class="p-6 md:p-10 lg:p-12 grid grid-cols-1 lg:grid-cols-3 gap-10">

            <!-- Input Form Section (Left/Center) -->
            <div class="lg:col-span-2">
                <h2 id="section-input-title" class="text-xl font-semibold mb-6 text-gray-700 border-b pb-2"></h2>

                <form id="calculator-form" class="space-y-6">

                    <!-- Loan Information -->
                    <div class="p-6 bg-blue-50 rounded-xl border border-blue-200">
                        <h3 id="section-loan-title" class="text-lg font-semibold mb-4 text-blue-800"></h3>
                        <div class="input-group">
                            <label for="loanTerm" id="label-loan-term" class="block text-sm font-medium text-gray-600 mb-1"></label>
                            <input type="number" id="loanTerm" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" min="1" max="50" value="30" oninput="calculateNetRent()">
                        </div>
                    </div>
                    
                    <!-- Income Section -->
                    <div class="p-6 bg-green-50 rounded-xl border border-green-200">
                        <h3 id="section-income-title" class="text-lg font-semibold mb-4 text-green-700"></h3>
                        <div id="income-inputs" class="space-y-4">
                            <!-- Income inputs will be generated here -->
                        </div>
                    </div>
                    
                    <!-- Expense Section -->
                    <div class="p-6 bg-red-50 rounded-xl border border-red-200">
                        <h3 id="section-expense-title" class="text-lg font-semibold mb-4 text-red-700"></h3>
                        <div id="expense-inputs" class="space-y-4">
                            <!-- Expense inputs will be generated here -->
                        </div>
                    </div>
                    
                </form>
            </div>

            <!-- Results Section (Right Column) -->
            <div class="lg:col-span-1">
                <div class="sticky top-4 space-y-8">
                    
                    <!-- Calculation Results -->
                    <div class="bg-blue-100 p-6 rounded-xl shadow-md border border-blue-300">
                        <h2 id="section-result-title" class="text-2xl font-bold text-blue-800 mb-4 pb-2 border-b border-blue-300"></h2>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center text-gray-700">
                                <span id="label-total-income" class="font-medium"></span>
                                <span id="result-total-income" class="font-bold text-green-600"></span>
                            </div>
                            <div class="flex justify-between items-center text-gray-700">
                                <span id="label-total-deductions" class="font-medium"></span>
                                <span id="result-total-deductions" class="font-bold text-red-600"></span>
                            </div>
                            <!-- Separator -->
                            <hr class="border-blue-300">
                            <div class="flex justify-between items-center text-2xl">
                                <span id="label-net-rent" class="font-extrabold text-blue-800"></span>
                                <span id="result-net-rent" class="font-extrabold text-blue-800"></span>
                            </div>
                            <p id="label-tax-effect" class="text-sm text-gray-500 pt-2"></p>
                        </div>
                    </div>

                    <!-- Visualization -->
                    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                        <h3 id="section-summary-title" class="text-lg font-semibold mb-4 text-gray-700"></h3>
                        <div class="chart-container">
                            <canvas id="expense-chart"></canvas>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>

        <!-- Footer / AdSense Slot -->
        <footer class="p-6 md:p-10 border-t bg-gray-50 rounded-b-2xl">
            <!-- Disclaimer and Notes -->
            <p id="disclaimer" class="text-xs text-gray-500 text-center mb-4"></p>
            
            <!-- AdSense Ad Placeholder (Below Calculation Summary) -->
            <div class="mt-8 pt-8 border-t border-gray-200 text-center">
                <p class="text-sm text-gray-500 mb-2">--- AdSense 广告位 ---</p>
                <!-- 2. AdSense 广告单元代码 (替换下面的 data-ad-slot) -->
                <!-- 注意：data-ad-client 已更新为 ca-pub-2834080926474637 -->
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-2834080926474637"
                     data-ad-slot="YOUR_AD_UNIT_ID" 
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
        </footer>

    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- Configuration and Data ---
        const LANGUAGES = {
            en: {
                title: "Australian Rental Property Tax Calculator",
                lang_en: "English",
                lang_zh: "中文",
                section_input_title: "Rental Income & Expenses (Annual)",
                section_loan_title: "Loan & Property Details",
                label_loan_term: "Loan Term (Years)",
                section_income_title: "Income",
                section_expense_title: "Expenses & Deductions",
                section_result_title: "Taxable Result Summary",
                label_total_income: "Total Gross Income",
                label_total_deductions: "Total Deductions",
                label_net_rent: "Net Rent (Taxable Income/Loss)",
                section_summary_title: "Deductions Breakdown",
                disclaimer: "*Disclaimer: This is an estimation tool based on ATO guidelines (2024). It is not financial or tax advice. Consult a registered tax professional for specific advice.",
                
                // Income Labels
                income: {
                    rent: { label: "Rent Received (Yearly)", tooltip: "Total rent collected during the financial year.", default: 25000 },
                    other: { label: "Other Income (e.g., Insurance Payouts)", tooltip: "Any other income related to the property.", default: 0 }
                },

                // Expense Labels (ATO Categories)
                expense: {
                    interest: { label: "Loan Interest", tooltip: "Interest paid on the loan used to purchase the property.", amortize: false, default: 15000 },
                    council_rates: { label: "Council Rates", tooltip: "Local government rates/taxes.", amortize: false, default: 1500 },
                    water_charges: { label: "Water Charges", tooltip: "Water usage and service charges.", amortize: false, default: 800 },
                    landlord_insurance: { label: "Landlord Insurance", tooltip: "Insurance premiums specific to renting out the property.", amortize: false, default: 600 },
                    body_corporate: { label: "Body Corporate Fees (Strata)", tooltip: "Fees paid to the body corporate/strata.", amortize: false, default: 3000 },
                    property_agent_fees: { label: "Property Agent Fees/Commission", tooltip: "Fees paid to the property manager.", amortize: false, default: 2000 },
                    repairs_maintenance: { label: "Repairs & Maintenance", tooltip: "General repairs (e.g., fixing a broken fence). Excludes capital improvements.", amortize: false, default: 1000 },
                    borrowing_expenses: { label: "Borrowing Expenses (e.g., Loan Fees)", tooltip: "Costs incurred to get the loan (e.g., loan establishment fees). Must be amortised over 5 years if total is >$100.", amortize: true, default: 1500, threshold: 100, years: 5 },
                    depreciation: { label: "Capital Allowances (Depreciation)", tooltip: "Deduction for the wear and tear of plant and equipment (e.g., ovens, carpets). Requires a Depreciation Schedule.", amortize: false, default: 3000 },
                    capital_works: { label: "Capital Works Deductions (Building Write-off)", tooltip: "Deduction for the cost of the building structure itself (usually 2.5% p.a.).", amortize: false, default: 4000 },
                    other_expenses: { label: "Other Expenses (e.g., Stationery, Travel)", tooltip: "Any other necessary rental expenses (e.g., travel to inspect property, accounting fees).", amortize: false, default: 500 }
                }
            },
            zh: {
                title: "澳大利亚出租物业税务计算器",
                lang_en: "英文",
                lang_zh: "中文",
                section_input_title: "年度租金收入与支出",
                section_loan_title: "贷款与物业详情",
                label_loan_term: "贷款期限 (年)",
                section_income_title: "收入",
                section_expense_title: "支出与抵扣项",
                section_result_title: "应税结果摘要",
                label_total_income: "总收入",
                label_total_deductions: "总抵扣额",
                label_net_rent: "净租金 (应税收入/亏损)",
                section_summary_title: "抵扣项细分",
                disclaimer: "*免责声明：这是一个基于 ATO 指南（2024财年）的估算工具。它不构成财务或税务建议。请咨询注册税务专业人士获取具体建议。",

                // Income Labels
                income: {
                    rent: { label: "租金收入 (年度)", tooltip: "财政年度内收取的总租金。", default: 25000 },
                    other: { label: "其他收入 (如：保险理赔)", tooltip: "与物业相关的任何其他收入。", default: 0 }
                },
                
                // Expense Labels (ATO Categories)
                expense: {
                    interest: { label: "贷款利息", tooltip: "用于购买出租物业的贷款利息。", amortize: false, default: 15000 },
                    council_rates: { label: "市政费", tooltip: "地方政府收取的费用/税款。", amortize: false, default: 1500 },
                    water_charges: { label: "水费", tooltip: "水费和服务费。", amortize: false, default: 800 },
                    landlord_insurance: { label: "房东保险", tooltip: "专用于出租物业的保险费。", amortize: false, default: 600 },
                    body_corporate: { label: "业主法团费用 (Strata)", tooltip: "向业主法团支付的费用。", amortize: false, default: 3000 },
                    property_agent_fees: { label: "物业中介费/佣金", tooltip: "支付给物业经理的费用。", amortize: false, default: 2000 },
                    repairs_maintenance: { label: "维修与保养", tooltip: "一般维修（例如：修理坏掉的围栏）。不包括资本改进。", amortize: false, default: 1000 },
                    borrowing_expenses: { label: "借贷费用 (如：贷款手续费)", tooltip: "为获得贷款而产生的费用（例如：贷款设立费）。如果总额超过 $100，必须在 5 年内摊销。", amortize: true, default: 1500, threshold: 100, years: 5 },
                    depreciation: { label: "资本免税额 (折旧)", tooltip: "对厂房和设备（例如：烤箱、地毯）磨损的抵扣。需要折旧报告。", amortize: false, default: 3000 },
                    capital_works: { label: "资本工程抵扣 (建筑结构)", tooltip: "建筑物结构成本的抵扣（通常为每年 2.5%）。", amortize: false, default: 4000 },
                    other_expenses: { label: "其他杂项支出 (如：文具、差旅)", tooltip: "任何其他必要的租赁支出（例如：检查物业的差旅费、会计费）。", amortize: false, default: 500 }
                }
            }
        };

        let currentLang = 'en';
        let chartInstance = null;

        // --- Utility Functions ---

        /**
         * Formats a number as AUD currency.
         * @param {number} value
         * @returns {string} Formatted currency string.
         */
        function formatCurrency(value) {
            return new Intl.NumberFormat('en-AU', {
                style: 'currency',
                currency: 'AUD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
        }

        /**
         * Gets the numeric value from an input field, defaulting to 0.
         * @param {string} id The input element's ID.
         * @returns {number} The parsed number.
         */
        function getInputValue(id) {
            const el = document.getElementById(id);
            return parseFloat(el.value) || 0;
        }

        /**
         * Creates a labeled input field with tooltip for the form.
         * @param {string} id Unique ID for the input.
         * @param {string} labelText Display label text.
         * @param {string} tooltipText Help text for the tooltip.
         * @param {number} defaultValue Initial value.
         * @returns {string} HTML string for the input group.
         */
        function createInputGroup(id, labelText, tooltipText, defaultValue) {
            return `
                <div class="input-group">
                    <div class="flex justify-between items-center mb-1">
                        <label for="${id}" class="block text-sm font-medium text-gray-600">
                            ${labelText}
                        </label>
                        <div class="tooltip-container">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-500 cursor-pointer" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span class="tooltip">${tooltipText}</span>
                        </div>
                    </div>
                    <input type="number" id="${id}" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" value="${defaultValue.toFixed(0)}" oninput="calculateNetRent()" min="0">
                </div>
            `;
        }

        // --- Core Logic ---

        /**
         * Calculates the deductible portion of borrowing expenses based on ATO rules.
         * @param {number} totalExpense Total borrowing expense amount.
         * @param {number} threshold The minimum threshold for amortization (e.g., $100).
         * @param {number} years The number of years for amortization (e.g., 5).
         * @returns {number} The deductible amount for the current year.
         */
        function calculateBorrowingDeduction(totalExpense, threshold, years) {
            if (totalExpense <= threshold) {
                // If total expense is $100 or less, it's fully deductible in the year incurred.
                return totalExpense;
            } else {
                // If total expense is more than $100, it's amortised over 5 years.
                return totalExpense / years;
            }
        }

        /**
         * The main function to calculate net rent and update the UI.
         */
        function calculateNetRent() {
            const langData = LANGUAGES[currentLang];
            let totalIncome = 0;
            let totalDeductions = 0;
            const expenseBreakdown = {};

            // 1. Calculate Total Income
            for (const key in langData.income) {
                const amount = getInputValue(`input-${key}`);
                totalIncome += amount;
            }

            // 2. Calculate Total Deductions
            for (const key in langData.expense) {
                const expenseConfig = langData.expense[key];
                const amount = getInputValue(`input-${key}`);
                let deductibleAmount = amount;

                if (expenseConfig.amortize) {
                    // Special ATO rule for Borrowing Expenses
                    deductibleAmount = calculateBorrowingDeduction(
                        amount, 
                        expenseConfig.threshold, 
                        expenseConfig.years
                    );
                }

                totalDeductions += deductibleAmount;
                expenseBreakdown[expenseConfig.label] = deductibleAmount;
            }

            // 3. Calculate Net Rent (Taxable Income/Loss)
            const netRent = totalIncome - totalDeductions;

            // 4. Update Results Dashboard
            document.getElementById('result-total-income').textContent = formatCurrency(totalIncome);
            document.getElementById('result-total-deductions').textContent = formatCurrency(totalDeductions);
            document.getElementById('result-net-rent').textContent = formatCurrency(netRent);

            // Update tax effect message
            let taxEffectMessage = "";
            if (netRent > 0) {
                taxEffectMessage = currentLang === 'en' 
                    ? `Taxable Income: This amount (${formatCurrency(netRent)}) will be added to your assessable income.`
                    : `应税收入: 此金额 (${formatCurrency(netRent)}) 将计入您的应评税收入。`;
                document.getElementById('result-net-rent').classList.replace('text-red-600', 'text-green-600');
            } else if (netRent < 0) {
                taxEffectMessage = currentLang === 'en' 
                    ? `Tax Loss: This amount (${formatCurrency(Math.abs(netRent))}) may offset other taxable income (Negative Gearing).`
                    : `税务亏损: 此金额 (${formatCurrency(Math.abs(netRent))}) 可用于抵消其他应税收入（负扣税）。`;
                document.getElementById('result-net-rent').classList.replace('text-green-600', 'text-red-600');
            } else {
                taxEffectMessage = currentLang === 'en' 
                    ? "Neutral Position: Income equals Deductions."
                    : "中性头寸: 收入等于支出。";
                document.getElementById('result-net-rent').classList.remove('text-green-600', 'text-red-600');
                document.getElementById('result-net-rent').classList.add('text-blue-800');
            }
            document.getElementById('label-tax-effect').textContent = taxEffectMessage;

            // 5. Update Chart
            updateChart(expenseBreakdown);
        }

        /**
         * Renders or updates the Chart.js instance.
         * @param {Object<string, number>} data A map of expense label to deductible amount.
         */
        function updateChart(data) {
            const chartLabels = Object.keys(data).filter(label => data[label] > 0);
            const chartValues = Object.values(data).filter(value => value > 0);

            if (chartInstance) {
                chartInstance.data.labels = chartLabels;
                chartInstance.data.datasets[0].data = chartValues;
                chartInstance.update();
                return;
            }

            const ctx = document.getElementById('expense-chart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: LANGUAGES[currentLang].section_summary_title,
                        data: chartValues,
                        backgroundColor: '#3b82f6', // Tailwind blue-500
                        borderColor: '#1e40af', // Tailwind blue-800
                        borderWidth: 1,
                        borderRadius: 6,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: currentLang === 'en' ? 'Deductible Amount (AUD)' : '抵扣金额 (澳元)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += formatCurrency(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        // --- UI Rendering ---

        /**
         * Renders the input fields for a given category (income or expense).
         * @param {string} containerId The ID of the container div.
         * @param {Object} categoryConfig The language configuration object for the category.
         */
        function renderInputs(containerId, categoryConfig) {
            const container = document.getElementById(containerId);
            let html = '';
            for (const key in categoryConfig) {
                const item = categoryConfig[key];
                html += createInputGroup(`input-${key}`, item.label, item.tooltip, item.default);
            }
            container.innerHTML = html;
        }

        /**
         * Updates all static UI text based on the current language.
         * @param {string} lang The target language code ('en' or 'zh').
         */
        function updateUI(lang) {
            const langData = LANGUAGES[lang];
            const elements = [
                'app-title', 'section-input-title', 'section-loan-title', 'label-loan-term',
                'section-income-title', 'section-expense-title', 'section-result-title',
                'label-total-income', 'label-total-deductions', 'label-net-rent', 
                'section-summary-title', 'disclaimer', 'lang-en', 'lang-zh'
            ];

            elements.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    if (id.startsWith('lang-')) {
                        el.textContent = langData[id];
                    } else {
                        el.textContent = langData[id];
                    }
                }
            });

            // Update language toggle button styling
            document.getElementById('lang-en').className = `text-sm font-semibold px-3 py-1 rounded-full transition-all duration-300 mr-2 ${lang === 'en' ? 'bg-white text-blue-800' : 'text-white hover:bg-blue-700'}`;
            document.getElementById('lang-zh').className = `text-sm font-semibold px-3 py-1 rounded-full transition-all duration-300 ${lang === 'zh' ? 'bg-white text-blue-800' : 'text-white hover:bg-blue-700'}`;

            // Re-render inputs to update labels and tooltips
            renderInputs('income-inputs', langData.income);
            renderInputs('expense-inputs', langData.expense);
            
            // Recalculate and re-render the chart title
            calculateNetRent(); 
        }

        /**
         * Sets the global language and updates the UI.
         * @param {string} lang The new language code.
         */
        function setLanguage(lang) {
            currentLang = lang;
            updateUI(currentLang);
            // Store preference in localStorage (optional)
            localStorage.setItem('calculatorLang', lang);
        }

        // --- Initialization ---

        window.onload = function() {
            // Load language preference or default to browser language
            const storedLang = localStorage.getItem('calculatorLang');
            const browserLang = navigator.language.startsWith('zh') ? 'zh' : 'en';
            currentLang = storedLang || browserLang;
            
            setLanguage(currentLang);
            
            // Initial calculation (which is called by updateUI, but just in case)
            calculateNetRent();
        };

    </script>
</body>
</html>
